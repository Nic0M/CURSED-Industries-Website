function calc_lcs(a,e){const b=a.length,c=e.length;let h=Array(b+1);for(var d=0;d<b+1;d++)h[d]=Array(c+1);for(d=0;d<b+1;d++)for(let k=0;k<c+1;k++)h[d][k]=0===d||0===k?0:a[d-1]===e[k-1]?1+h[d-1][k-1]:Math.max(h[d-1][k],h[d][k-1]);return h[b][c]}
function search_table(a,e,b,c=!1){var h=document.getElementById(a);if(h)if(a=document.getElementById(e))if(e=h.value,""===e)for(b=a.getElementsByTagName("tr"),c=1;c<b.length;c++)b[c].style.display="";else if(c||(e=e.toLowerCase()),h=a.getElementsByTagName("tr"),1>h.length)console.error("Table has no header row");else{a=h[0];for(let d=1;d<h.length;d++){const k=h[d].getElementsByTagName("td");let m=!1;for(let f=0;f<b.length;f++){if(f>=a.cells.length){console.error(`Column index ${b[f]} out of range`);
continue}let g=k[b[f]].innerText;switch(a.cells[b[f]].innerText){case "Unique ID":c||(g=g.toLowerCase());lcs=calc_lcs(e,g);3>Math.abs(lcs-e.length)?(m=!0,console.log(`Match found: ${e} and ${g}`)):console.log(`No match: ${e} and ${g}`);break;default:c||(g=g.toLowerCase()),g.includes(e)&&(console.log(`Default match found: ${e} and ${g}`),m=!0)}if(m){h[d].style.display="";break}}m||(h[d].style.display="none")}}else console.error(`No table with id ${e}`);else console.error(`No search bar with id ${a}`)}
;function format_speed(a){return a+" m/s"}function format_altitude(a){return null===a?"Unknown":a+" m"}function format_heading(a){return 90>a?a+"\u00b0 NE":180>a?a+"\u00b0 SE":270>a?a+"\u00b0 SW":360>a?a+"\u00b0 NW":a+"\u00b0"}function format_latitude(a){a=parseFloat(a);return 0>a?(-a).toFixed(6)+"\u00b0 S":a.toFixed(6)+"\u00b0 N"}function format_longitude(a){a=parseFloat(a);return 0>a?(-a).toFixed(6)+"\u00b0 W":a.toFixed(6)+"\u00b0 E"}
function format_timestamp(a){"string"!==typeof a||a.endsWith("Z")||(a+="Z");return(new Date(a)).toLocaleString("en-US",{timeZone:"America/Denver",timeZoneName:"short"})}
function format_duration(a){return 60>a?a+(1===a?" second":" seconds"):3600>a?Math.floor(a/60)+(1===Math.floor(a/60)?" minute ":" minutes ")+format_duration(a%60):86400>a?Math.floor(a/3600)+(1===Math.floor(a/3600)?" hour ":" hours ")+format_duration(a%3600):Math.floor(a/86400)+(1===Math.floor(a/86400)?" day ":" days ")+format_duration(a%86400)}
function updateDateStr(a,e){e=document.getElementsByClassName(e);if(0===e.length)console.log("No last refreshed elements found. Cannot update last refreshed time.");else{a*=1E3;var b=(Date.now()-a)/1E3,c="Last refreshed: ";60>b?(c+=Math.floor(b).toString(),c=1!==b?c+" seconds ago":c+" second ago"):3600>b?(b=Math.floor(b/60),c+=b.toString(),c=1!==b?c+" minutes ago":c+" minute ago"):86400>b?(b=Math.floor(b/3600),c+=b.toString(),c=1!==b?c+" hours ago":c+" hour ago"):(b=Math.floor(b/86400),c+=b.toString(),
c=1!==b?c+" days ago":c+" day ago");a=(new Date(a)).toLocaleString("en-US",{timeZone:"America/Denver",timeZoneName:"short"});c+=" at "+a;for(a=0;a<e.length;a++)e[a].innerText=c}}
function createSearchBar(a,e){const b=document.getElementById(a);if(b){b.innerHTML="";a=document.createElement("input");var c=e+"-search-bar";a.setAttribute("id",c);a.setAttribute("placeholder","Search by unique ID, flight date, or location...");a.setAttribute("style","width: 50%;");a.setAttribute("class","form-control");a.addEventListener("input",function(){search_table(c,e,[0],!1)});return a}console.log("Search bar div does not exist:",a);console.log("Cannot create search bar.")}
function searchTable(a,e){a=document.getElementById(a).value.toLowerCase();e=document.getElementById(e).getElementsByTagName("tr");for(let b=1;b<e.length;b++){const c=e[b].getElementsByTagName("td");let h=!1;for(let d=0;d<c.length;d++)if(c[d].innerText.toLowerCase().includes(a)){h=!0;break}e[b].style.display=h?"":"none"}}
async function getActiveFlights(){try{const k=await fetch("https://cursedindustries.com/wp-json/drones/v1/active-flights"),m=await k.json();console.log(m);const f=document.getElementById("active-flights-table");f.innerHTML="";f.setAttribute("style","overflow-x: scroll;");if(200!==k.status)f.innerHTML="Error: Could not fetch list of active flights. Please try again later.";else{var a=document.createElement("div");a.setAttribute("id","active-flights-search-bar-div");f.appendChild(a);var e=createSearchBar("active-flights-search-bar-div",
"active-flights-table");a.appendChild(e);var b=document.createElement("p");b.setAttribute("class","active-flights-last-refreshed-text");f.appendChild(b);updateDateStr(m.current_time,"active-flights-last-refreshed-text");var c=document.createElement("table"),h=c.createTHead();c.setAttribute("class","table table-striped");var d=h.insertRow();d.setAttribute("style","background-color: #00aa00; color: black;");d.insertCell().innerHTML="Unique ID";d.insertCell().innerHTML="Latitude";d.insertCell().innerHTML=
"Longitude";d.insertCell().innerHTML="Altitude";d.insertCell().innerHTML="Ground Speed";d.insertCell().innerHTML="Vertical Speed";d.insertCell().innerHTML="Heading";d.insertCell().innerHTML="Last Updated";m.flights.forEach(g=>{const l=c.insertRow();l.insertCell().innerHTML=g.unique_id;l.insertCell().innerHTML=format_latitude(g.lat);l.insertCell().innerHTML=format_longitude(g.lon);l.insertCell().innerHTML=format_altitude(g.alt);l.insertCell().innerHTML=format_speed(g.gnd_speed);l.insertCell().innerHTML=
format_speed(g.vert_speed);l.insertCell().innerHTML=format_heading(g.heading);l.insertCell().innerHTML=format_timestamp(g.timestamp)});f.appendChild(c);0!==active_flights_refresh_time_text_interval_id&&clearInterval(active_flights_refresh_time_text_interval_id);active_flights_refresh_time_text_interval_id=setInterval(()=>updateDateStr(m.current_time,"active-flights-last-refreshed-text"),refresh_text_interval_time)}}catch(k){console.log("Error:",k)}}
async function getHistoricalFlights(){try{url="https://cursedindustries.com/wp-json/drones/v1/historical-flights";const f=await fetch(url,{method:"GET",headers:{"Content-Type":"application/json"}}),g=await f.json();if(200!==f.status)console.log("Error:",g);else{var a=document.getElementById("historical-flights-table");a.innerHTML="";a.setAttribute("style","overflow-x: scroll;");var e=document.createElement("div");e.setAttribute("id","historical-flights-search-bar-div");a.appendChild(e);var b=createSearchBar("historical-flights-search-bar-div",
"historical-flights-table");e.appendChild(b);var c=document.createElement("p");c.setAttribute("class","historical-flights-last-refreshed-text");a.appendChild(c,"historical-flights-last-refreshed-text");var h=NaN;void 0!==g.current_time?h=g.current_time:(console.log("Current time could not be parsed from the response. Displaying NaN as last refreshed time."),h=NaN);updateDateStr(h,"historical-flights-last-refreshed-text");0!==historical_flights_refresh_time_text_interval_id&&clearInterval(historical_flights_refresh_time_text_interval_id);
historical_flights_refresh_time_text_interval_id=setInterval(()=>updateDateStr(h,"historical-flights-last-refreshed-text"),refresh_text_interval_time);var d=document.createElement("table");d.setAttribute("class","table table-striped");var k=d.createTHead().insertRow();k.insertCell().innerHTML="Unique ID";k.insertCell().innerHTML="Duration";k.insertCell().innerHTML="Start Time";k.insertCell().innerHTML="End Time";k.insertCell().innerHTML="Max Height AGL";k.insertCell().innerHTML="Max Speed";var m=
d.createTBody();g.flights.forEach(l=>{const n=m.insertRow();n.insertCell().innerHTML=l.unique_id;n.insertCell().innerHTML=format_duration(l.duration);n.insertCell().innerHTML=l.start_time;n.insertCell().innerHTML=l.end_time;n.insertCell().innerHTML=format_altitude(l.max_height_agl);n.insertCell().innerHTML=format_speed(l.max_gnd_speed)});a.appendChild(d)}}catch(f){console.log("Error:",f)}}let current_offset=0;const limit=25;
async function getRemoteIDPackets(a){try{const g=await fetch(`https://cursedindustries.com/wp-json/drones/v1/remoteid-packets?offset=${current_offset}&limit=${limit}`),l=await g.json();if(200!==g.status)console.log("Error: Could not fetch list of Remote ID packets. Please try again later."),console.log("Response:",l);else{var e=document.getElementById("remoteid-packets-table");e.innerHTML="";e.setAttribute("style","");var b=document.createElement("div");b.setAttribute("id","remoteid-packets-search-bar-div");
e.appendChild(b);var c=createSearchBar("remoteid-packets-search-bar-div","remoteid-packets-table");b.appendChild(c);var h=document.createElement("p");h.setAttribute("class","remoteid-packets-last-refreshed-text");e.appendChild(h);var d=NaN;void 0!==l.current_time?d=l.current_time:(console.log("Current time could not be parsed from the response. Displaying NaN as last refreshed time."),d=NaN);updateDateStr(d,"remoteid-packets-last-refreshed-text");0!==remoteid_packets_refresh_time_text_interval_id&&
clearInterval(remoteid_packets_refresh_time_text_interval_id);remoteid_packets_refresh_time_text_interval_id=setInterval(()=>updateDateStr(d,"remoteid-packets-last-refreshed-text"),refresh_text_interval_time);var k=document.createElement("div");k.setAttribute("style","overflow-x: scroll; overflow-y: scroll; height: 75vh; position: relative;");e.appendChild(k);var m=document.createElement("table"),f=m.createTHead().insertRow();f.setAttribute("style","background-color: #00aa00; color: black; position: sticky; top: 0;");
f.insertCell().innerHTML="Unique ID";f.insertCell().innerHTML="Timestamp";f.insertCell().innerHTML="Heading";f.insertCell().innerHTML="Ground Speed";f.insertCell().innerHTML="Vertical Speed";f.insertCell().innerHTML="Latitude";f.insertCell().innerHTML="Longitude";f.insertCell().innerHTML="Altitude";l.packets.forEach(n=>{const p=m.insertRow();p.insertCell().innerHTML=n.unique_id;p.insertCell().innerHTML=format_timestamp(n.timestamp);p.insertCell().innerHTML=format_heading(n.heading);p.insertCell().innerHTML=
format_speed(n.gnd_speed);p.insertCell().innerHTML=format_speed(n.vert_speed);p.insertCell().innerHTML=format_latitude(n.lat);p.insertCell().innerHTML=format_longitude(n.lon);p.insertCell().innerHTML=format_altitude(n.geoAlt)});k.appendChild(m)}}catch(g){console.log("Error:",g)}}
async function getRaspberryPiStatus(){try{const m=await fetch("https://cursedindustries.com/wp-json/healthcheck/v1/get_healthchecks"),f=await m.json();if(200!==m.status)console.log("Error:",f);else{var a=document.getElementById("healthchecks-table");a.innerHTML="";if(void 0===f.healthchecks)console.log("No healthchecks found in response.");else{var e=f.healthchecks,b=document.createElement("table");b.setAttribute("class","healthchecks-table");b.setAttribute("style","overflow-x: scroll;");var c=b.createTHead().insertRow();
c.insertCell().innerHTML="Receiver ID";c.insertCell().innerHTML="Status";c.insertCell().innerHTML="Last Updated";c.insertCell().innerHTML="Received Packets";var h=b.createTBody();e.forEach(g=>{const l=h.insertRow();l.insertCell().innerHTML=g.id;l.insertCell().innerHTML=g.status;l.insertCell().innerHTML=g.updated_at;l.insertCell().innerHTML=g.received_packets});var d=document.createElement("p");d.setAttribute("class","healthchecks-last-refreshed-text");a.appendChild(d);var k=NaN;void 0!==f.current_time?
k=f.current_time:(console.log("Current time could not be parsed from the response. Displaying NaN as last refreshed time."),k=NaN);updateDateStr(k,"healthchecks-last-refreshed-text");0!==healthchecks_refresh_time_text_interval_id&&clearInterval(healthchecks_refresh_time_text_interval_id);healthchecks_refresh_time_text_interval_id=setInterval(()=>updateDateStr(k,"healthchecks-last-refreshed-text"),refresh_text_interval_time);a.appendChild(d);a.appendChild(b)}}}catch(m){console.log("Error:",m)}}
let active_flights_refresh_time_text_interval_id=0,historical_flights_refresh_time_text_interval_id=0,remoteid_packets_refresh_time_text_interval_id=0,healthchecks_refresh_time_text_interval_id=0,refresh_text_interval_time=450;console.log("Creating active flights table");getActiveFlights();console.log("Creating historical flights table");getHistoricalFlights();console.log("Create Remote ID packets table");getRemoteIDPackets();console.log("Create Raspberry Pi status table");getRaspberryPiStatus();
setInterval(getActiveFlights,3E4);setInterval(getHistoricalFlights,3E5);setInterval(getRemoteIDPackets,3E5);setInterval(getRaspberryPiStatus,3E5);
