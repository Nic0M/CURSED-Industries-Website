function calc_lcs(a,e){const b=a.length,c=e.length;let g=Array(b+1);for(var d=0;d<b+1;d++)g[d]=Array(c+1);for(d=0;d<b+1;d++)for(let h=0;h<c+1;h++)g[d][h]=0===d||0===h?0:a[d-1]===e[h-1]?1+g[d-1][h-1]:Math.max(g[d-1][h],g[d][h-1]);return g[b][c]}
function search_table(a,e,b,c=!1){var g=document.getElementById(a);if(g)if(a=document.getElementById(e))if(e=g.value,""===e)for(b=a.getElementsByTagName("tr"),c=1;c<b.length;c++)b[c].style.display="";else if(c||(e=e.toLowerCase()),g=a.getElementsByTagName("tr"),1>g.length)console.error("Table has no header row");else{a=g[0];for(let d=1;d<g.length;d++){const h=g[d].getElementsByTagName("td");let n=!1;for(let k=0;k<b.length;k++){if(k>=a.cells.length){console.error(`Column index ${b[k]} out of range`);
continue}let f=h[b[k]].innerText;switch(a.cells[b[k]].innerText){case "Unique ID":c||(f=f.toLowerCase());lcs=calc_lcs(e,f);3>Math.abs(lcs-e.length)?(n=!0,console.log(`Match found: ${e} and ${f}`)):console.log(`No match: ${e} and ${f}`);break;default:c||(f=f.toLowerCase()),f.includes(e)&&(console.log(`Default match found: ${e} and ${f}`),n=!0)}if(n){g[d].style.display="";break}}n||(g[d].style.display="none")}}else console.error(`No table with id ${e}`);else console.error(`No search bar with id ${a}`)}
;function format_speed(a){return a+" m/s"}function format_altitude(a){return null===a?"Unknown":a+" m"}function format_heading(a){return 90>a?a+"\u00b0 NE":180>a?a+"\u00b0 SE":270>a?a+"\u00b0 SW":360>a?a+"\u00b0 NW":a+"\u00b0"}function format_latitude(a){a=parseFloat(a);return 0>a?(-a).toFixed(6)+"\u00b0 S":a.toFixed(6)+"\u00b0 N"}function format_longitude(a){a=parseFloat(a);return 0>a?(-a).toFixed(6)+"\u00b0 W":a.toFixed(6)+"\u00b0 E"}
function format_timestamp(a){"string"!==typeof a||a.endsWith("Z")||(a+="Z");return(new Date(a)).toLocaleString("en-US",{timeZone:"America/Denver",timeZoneName:"short"})}
function format_duration(a){return 60>a?a+(1===a?" second":" seconds"):3600>a?Math.floor(a/60)+(1===Math.floor(a/60)?" minute ":" minutes ")+format_duration(a%60):86400>a?Math.floor(a/3600)+(1===Math.floor(a/3600)?" hour ":" hours ")+format_duration(a%3600):Math.floor(a/86400)+(1===Math.floor(a/86400)?" day ":" days ")+format_duration(a%86400)}
function updateDateStr(a,e){e=document.getElementsByClassName(e);if(0===e.length)console.log("No last refreshed elements found. Cannot update last refreshed time.");else{a*=1E3;var b=(Date.now()-a)/1E3,c="Last refreshed: ";60>b?(c+=Math.floor(b).toString(),c=1!==b?c+" seconds ago":c+" second ago"):3600>b?(b=Math.floor(b/60),c+=b.toString(),c=1!==b?c+" minutes ago":c+" minute ago"):86400>b?(b=Math.floor(b/3600),c+=b.toString(),c=1!==b?c+" hours ago":c+" hour ago"):(b=Math.floor(b/86400),c+=b.toString(),
c=1!==b?c+" days ago":c+" day ago");a=(new Date(a)).toLocaleString("en-US",{timeZone:"America/Denver",timeZoneName:"short"});c+=" at "+a;for(a=0;a<e.length;a++)e[a].innerText=c}}
function createSearchBar(a,e){const b=document.getElementById(a);if(b){b.innerHTML="";a=document.createElement("input");var c=e+"-search-bar";a.setAttribute("id",c);a.setAttribute("placeholder","Search by unique ID, flight date, or location...");a.setAttribute("style","width: 50%;");a.setAttribute("class","form-control");a.addEventListener("input",function(){search_table(c,e,[0],!1)});return a}console.log("Search bar div does not exist:",a);console.log("Cannot create search bar.")}
function searchTable(a,e){a=document.getElementById(a).value.toLowerCase();e=document.getElementById(e).getElementsByTagName("tr");for(let b=1;b<e.length;b++){const c=e[b].getElementsByTagName("td");let g=!1;for(let d=0;d<c.length;d++)if(c[d].innerText.toLowerCase().includes(a)){g=!0;break}e[b].style.display=g?"":"none"}}
async function getActiveFlights(){try{const h=await fetch("https://cursedindustries.com/wp-json/drones/v1/active-flights"),n=await h.json();console.log(n);const k=document.getElementById("active-flights-table");k.innerHTML="";k.setAttribute("style","overflow-x: scroll;");if(200!==h.status)k.innerHTML="Error: Could not fetch list of active flights. Please try again later.";else{var a=document.createElement("div");a.setAttribute("id","active-flights-search-bar-div");k.appendChild(a);var e=createSearchBar("active-flights-search-bar-div",
"active-flights-table");a.appendChild(e);var b=document.createElement("p");b.setAttribute("class","active-flights-last-refreshed-text");k.appendChild(b);updateDateStr(n.current_time,"active-flights-last-refreshed-text");var c=document.createElement("table"),g=c.createTHead();c.setAttribute("class","table table-striped");var d=g.insertRow();d.setAttribute("style","background-color: #00aa00; color: black;");d.insertCell().innerHTML="Unique ID";d.insertCell().innerHTML="Latitude";d.insertCell().innerHTML=
"Longitude";d.insertCell().innerHTML="Altitude";d.insertCell().innerHTML="Ground Speed";d.insertCell().innerHTML="Vertical Speed";d.insertCell().innerHTML="Heading";d.insertCell().innerHTML="Last Updated";n.flights.forEach(f=>{const l=c.insertRow();l.insertCell().innerHTML=f.unique_id;l.insertCell().innerHTML=format_latitude(f.lat);l.insertCell().innerHTML=format_longitude(f.lon);l.insertCell().innerHTML=format_altitude(f.alt);l.insertCell().innerHTML=format_speed(f.gnd_speed);l.insertCell().innerHTML=
format_speed(f.vert_speed);l.insertCell().innerHTML=format_heading(f.heading);l.insertCell().innerHTML=format_timestamp(f.timestamp)});k.appendChild(c);0!==active_flights_refresh_time_text_interval_id&&clearInterval(active_flights_refresh_time_text_interval_id);active_flights_refresh_time_text_interval_id=setInterval(()=>updateDateStr(n.current_time,"active-flights-last-refreshed-text"),refresh_text_interval_time)}}catch(h){console.log("Error:",h)}}
async function getHistoricalFlights(){try{url="https://cursedindustries.com/wp-json/drones/v1/historical-flights";const k=await fetch(url,{method:"GET",headers:{"Content-Type":"application/json"}}),f=await k.json();if(200!==k.status)console.log("Error:",f);else{var a=document.getElementById("historical-flights-table");a.innerHTML="";a.setAttribute("style","overflow-x: scroll;");var e=document.createElement("div");e.setAttribute("id","historical-flights-search-bar-div");a.appendChild(e);var b=createSearchBar("historical-flights-search-bar-div",
"historical-flights-table");e.appendChild(b);var c=document.createElement("p");c.setAttribute("class","historical-flights-last-refreshed-text");a.appendChild(c,"historical-flights-last-refreshed-text");var g=NaN;void 0!==f.current_time?g=f.current_time:(console.log("Current time could not be parsed from the response. Displaying NaN as last refreshed time."),g=NaN);updateDateStr(g,"historical-flights-last-refreshed-text");0!==historical_flights_refresh_time_text_interval_id&&clearInterval(historical_flights_refresh_time_text_interval_id);
historical_flights_refresh_time_text_interval_id=setInterval(()=>updateDateStr(g,"historical-flights-last-refreshed-text"),refresh_text_interval_time);var d=document.createElement("table");d.setAttribute("class","table table-striped");var h=d.createTHead().insertRow();h.insertCell().innerHTML="Unique ID";h.insertCell().innerHTML="Duration";h.insertCell().innerHTML="Start Time";h.insertCell().innerHTML="End Time";h.insertCell().innerHTML="Max Height AGL";h.insertCell().innerHTML="Max Speed";var n=
d.createTBody();f.flights.forEach(l=>{const m=n.insertRow();m.insertCell().innerHTML=l.unique_id;m.insertCell().innerHTML=format_duration(l.duration);m.insertCell().innerHTML=l.start_time;m.insertCell().innerHTML=l.end_time;m.insertCell().innerHTML=format_altitude(l.max_height_agl);m.insertCell().innerHTML=format_speed(l.max_gnd_speed)});a.appendChild(d)}}catch(k){console.log("Error:",k)}}let current_offset=0;const limit=25;
async function getRemoteIDPackets(a){try{const f=await fetch(`https://cursedindustries.com/wp-json/drones/v1/remoteid-packets?offset=${current_offset}&limit=${limit}`),l=await f.json();if(200!==f.status)console.log("Error: Could not fetch list of Remote ID packets. Please try again later."),console.log("Response:",l);else{var e=document.getElementById("remoteid-packets-table");e.innerHTML="";e.setAttribute("style","");var b=document.createElement("div");b.setAttribute("id","remoteid-packets-search-bar-div");
e.appendChild(b);var c=createSearchBar("remoteid-packets-search-bar-div","remoteid-packets-table");b.appendChild(c);var g=document.createElement("p");g.setAttribute("class","remoteid-packets-last-refreshed-text");e.appendChild(g);var d=NaN;void 0!==l.current_time?d=l.current_time:(console.log("Current time could not be parsed from the response. Displaying NaN as last refreshed time."),d=NaN);updateDateStr(d,"remoteid-packets-last-refreshed-text");0!==remoteid_packets_refresh_time_text_interval_id&&
clearInterval(remoteid_packets_refresh_time_text_interval_id);remoteid_packets_refresh_time_text_interval_id=setInterval(()=>updateDateStr(d,"remoteid-packets-last-refreshed-text"),refresh_text_interval_time);var h=document.createElement("div");h.setAttribute("style","overflow-x: scroll; overflow-y: scroll; height: 75vh; position: relative;");e.appendChild(h);var n=document.createElement("table"),k=n.createTHead().insertRow();k.setAttribute("style","background-color: #00aa00; color: black; position: sticky; top: 0;");
k.insertCell().innerHTML="Unique ID";k.insertCell().innerHTML="Timestamp";k.insertCell().innerHTML="Heading";k.insertCell().innerHTML="Ground Speed";k.insertCell().innerHTML="Vertical Speed";k.insertCell().innerHTML="Latitude";k.insertCell().innerHTML="Longitude";k.insertCell().innerHTML="Altitude";l.packets.forEach(m=>{const p=n.insertRow();p.insertCell().innerHTML=m.unique_id;p.insertCell().innerHTML=format_timestamp(m.timestamp);p.insertCell().innerHTML=format_heading(m.heading);p.insertCell().innerHTML=
format_speed(m.gnd_speed);p.insertCell().innerHTML=format_speed(m.vert_speed);p.insertCell().innerHTML=format_latitude(m.lat);p.insertCell().innerHTML=format_longitude(m.lon);p.insertCell().innerHTML=format_altitude(m.geoAlt)});h.appendChild(n)}}catch(f){console.log("Error:",f)}}
async function getRaspberryPiStatus(){try{const n=await fetch("https://cursedindustries.com/wp-json/healthcheck/v1/get_healthchecks"),k=await fetch(n),f=await k.json();if(200!==k.status)console.log("Error:",f);else{var a=document.getElementById("healthchecks-table");a.innerHTML="";if(void 0===f.healthchecks)console.log("No healthchecks found in response.");else{var e=f.healthchecks,b=document.createElement("table");b.setAttribute("class","healthchecks-table");b.setAttribute("style","overflow-x: scroll;");
var c=b.createTHead().insertRow();c.insertCell().innerHTML="Receiver ID";c.insertCell().innerHTML="Status";c.insertCell().innerHTML="Last Updated";c.insertCell().innerHTML="Received Packets";var g=b.createTBody();e.forEach(l=>{const m=g.insertRow();m.insertCell().innerHTML=l.id;m.insertCell().innerHTML=l.status;m.insertCell().innerHTML=l.updated_at;m.insertCell().innerHTML=l.received_packets});var d=document.createElement("p");d.setAttribute("class","healthchecks-last-refreshed-text");a.appendChild(d);
var h=NaN;void 0!==f.current_time?h=f.current_time:(console.log("Current time could not be parsed from the response. Displaying NaN as last refreshed time."),h=NaN);updateDateStr(h,"healthchecks-last-refreshed-text");0!==healthchecks_refresh_time_text_interval_id&&clearInterval(healthchecks_refresh_time_text_interval_id);healthchecks_refresh_time_text_interval_id=setInterval(()=>updateDateStr(h,"healthchecks-last-refreshed-text"),refresh_text_interval_time);a.appendChild(d);a.appendChild(b)}}}catch(n){console.log("Error:",
n)}}let active_flights_refresh_time_text_interval_id=0,historical_flights_refresh_time_text_interval_id=0,remoteid_packets_refresh_time_text_interval_id=0,raspberry_pi_status_refresh_time_text_interval_id=0,refresh_text_interval_time=450;console.log("Creating active flights table");getActiveFlights();console.log("Creating historical flights table");getHistoricalFlights();console.log("Create Remote ID packets table");getRemoteIDPackets();console.log("Create Raspberry Pi status table");getRaspberryPiStatus();
setInterval(getActiveFlights,3E4);setInterval(getHistoricalFlights,3E5);setInterval(getRemoteIDPackets,3E5);setInterval(getRaspberryPiStatus,3E5);
